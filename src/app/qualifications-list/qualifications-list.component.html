<div class="qualifications-container">
  <header class="page-header">
    <h1 class="page-title">Qualifikations√ºbersichtüéì</h1>
    <p class="page-description">
      Alle Mitarbeiterqualifikationen hier ansehen und verwalten.
    </p>
  </header>

  <div class="qualifications-list">
    <div class="list-header">
      <!-- Search -->
      <div class="list-search">
        <img
          class="list-search-icon"
          src="/MagnifyingGlass.webp"
          alt="search"
        />
        <input
          type="text"
          class="list-search-input"
          placeholder="Suche nach Bezeichnung"
          [value]="searchTerm()"
          (input)="onSearchChange($any($event.target).value)"
        />
      </div>

      <button class="btn btn-primary" (click)="openCreateModal()">
        <span class="icon">+</span> Neue Qualifikation
      </button>
    </div>

    <div
      class="modal-backdrop"
      *ngIf="isModalOpen()"
      (click)="onBackdropClick($event)"
    >
      <div class="modal">
        <!-- Modal Header -->
        <div class="modal-header">
          <div class="modal-header-close" (click)="closeModal()">
            <button class="modal-close">
              <img src="/ArrowSquareLeft.webp" alt="leftarrow" />
            </button>
            <span>Zur√ºck zur √úbersicht</span>
          </div>
          <h2>
            @switch (modalType()) { @case ('create') { Neue Qualifikation
            erstellen } @case ('edit') { Qualifikation bearbeiten } @case
            ('delete') { Qualifikation l√∂schen? } @case ('view') { Mitarbeiter
            mit Qualifikation "{{ selectedQualification()?.skill }}" } }
          </h2>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
          @switch (modalType()) { @case ('create') {
          <app-qualification-form
            [form]="qualificationForm"
            (submit)="createQualification()"
            (cancel)="closeModal()"
          />
          } @case ('edit') {
          <app-qualification-form
            [form]="qualificationForm"
            [isEdit]="true"
            (submit)="updateQualification()"
            (cancel)="closeModal()"
          />
          } @case ('delete') {
          <p>
            M√∂chten Sie "{{ selectedQualification()?.skill }}" wirklich l√∂schen?
          </p>
          <div class="modal-actions">
            <button class="btn btn-danger" (click)="confirmDelete()">
              L√∂schen
            </button>
            <button class="btn btn-secondary" (click)="closeModal()">
              Abbrechen
            </button>
          </div>
          } @case ('view') {
          <app-employee-list
            [qualificationId]="selectedQualification()?.id!"
            (employeesChanged)="loadQualifications()"
            (closeRequested)="closeModal()"
          />
          } }
        </div>
      </div>
    </div>

    <!-- Qualifications Table -->
    <div class="table-wrapper" *ngIf="filteredQualifications().length > 0">
      <table class="qualifications-table">
        <thead>
          <tr>
            <th>Bezeichnung</th>
            <th>Mitarbeiter</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let qualification of filteredQualifications()">
            <td>{{ qualification.skill }}</td>

            <td class="employee-count">
              {{ getEmployeeCount(qualification.id) }}
            </td>

            <td class="actions-cell">
              <button
                class="action-icon"
                (click)="openViewModal(qualification)"
                title="View employees with this qualification"
              >
                <img src="/eye.webp" alt="view" class="trash-icon" />
              </button>

              <button
                class="action-icon"
                (click)="openEditModal(qualification)"
                title="Edit qualification"
              >
                <img
                  src="/PencilSimpleLine.webp"
                  alt="edit"
                  class="edit-icon"
                />
              </button>

              <button
                class="action-icon"
                (click)="openDeleteModal(qualification)"
                title="Delete qualification"
              >
                <img src="/Trash.webp" alt="delete" class="trash-icon" />
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <span class="page-description">
        {{ filteredQualifications().length }} von
        {{ qualifications().length }} Eintr√§gen
      </span>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="
        filteredQualifications().length === 0 && qualifications().length > 0
      "
      class="empty-state"
    >
      <p>Keine Qualifikationen gefunden f√ºr "{{ searchTerm() }}"</p>
      <button class="btn btn-secondary" (click)="searchTerm.set('')">
        Filter zur√ºcksetzen
      </button>
    </div>

    <!-- No Data State -->
    <div *ngIf="qualifications().length === 0" class="empty-state">
      <p>Keine Qualifikationen vorhanden.</p>
      <button class="btn btn-primary" (click)="openCreateModal()">
        Erste Qualifikation erstellen
      </button>
    </div>
  </div>
</div>
